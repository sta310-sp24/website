{
  "hash": "9f8a593099a0bd56dfa886950330a926",
  "result": {
    "markdown": "---\ntitle: \"Lecture 05 AE: Poisson Regression\"\nsubtitle: \"Goodness-of-fit and overdispersion\"\ndate: \"2024-01-29\"\nexecute: \n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(knitr)\n# add other packages as needed\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhh_data <- read_csv(\"data/fHH1.csv\")\n```\n:::\n\n\n## Household vs. age, age\\^2, and location\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhh_age_loc <- glm(total ~ age + I(age^2) + location, \n                  data = hh_data, family = poisson)\n\ntidy(hh_age_loc, conf.int = T) |> \n  kable(digits = 4)\n```\n\n::: {.cell-output-display}\n|term                 | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:--------------------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept)          |  -0.3843|    0.1821|   -2.1107|  0.0348|  -0.7444|   -0.0306|\n|age                  |   0.0704|    0.0069|   10.1900|  0.0000|   0.0569|    0.0840|\n|I(age^2)             |  -0.0007|    0.0001|  -10.9437|  0.0000|  -0.0008|   -0.0006|\n|locationDavaoRegion  |  -0.0194|    0.0538|   -0.3605|  0.7185|  -0.1250|    0.0859|\n|locationIlocosRegion |   0.0610|    0.0527|    1.1580|  0.2468|  -0.0423|    0.1641|\n|locationMetroManila  |   0.0545|    0.0472|    1.1542|  0.2484|  -0.0378|    0.1473|\n|locationVisayas      |   0.1121|    0.0417|    2.6853|  0.0072|   0.0308|    0.1945|\n:::\n:::\n\n\n::: callout-tip\n## Calculating residuals in R\n\nYou can get the residuals in two ways:\n\n1.  `residuals` function with `type = \"pearson\"` or `type = \"deviance\"`.\n\n2.  `augment` function with `type.residuals = \"pearson\"` or `type.residuals = deviance`.\n:::\n\n## Calculate model deviance & Goodness-of-fit\n\n::: callout-note\n## Ex 1\n\nUse the deviance residuals to calculate the model deviance.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate model deviance\n```\n:::\n\n\n::: callout-note\n## Ex 2\n\nCheck your work above using the `glance` function.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get deviance using glance function\n```\n:::\n\n\n::: callout-note\n## Ex 3\n\nConduct a goodness-of-fit test\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Conduct goodness-of-fit test\n```\n:::\n\n\n## Quasi-Poisson\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhh_age_loc_q <- glm(total ~ age + I(age^2) + location, \n                    data = hh_data, family = quasipoisson)\n```\n:::\n\n\n::: callout-note\n## Ex 4\n\nWhat do we expect the dispersion parameter to be if there is no overdispersion?\n:::\n\n::: callout-note\n## Ex 5\n\nUse the Pearson residuals to calculate the dispersion parameter.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate dispersion parameter \n```\n:::\n\n\n::: callout-note\n## Ex 6\n\nView the dispersion parameter in the model output\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#summary(hh_age_loc_q)\n```\n:::\n\n\n## Negative binomial regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhh_age_loc_nb <- MASS::glm.nb(total ~ age + I(age^2) + location, data = hh_data)\ntidy(hh_age_loc_nb) |> \n  kable(digits = 4)\n```\n\n::: {.cell-output-display}\n|term                 | estimate| std.error| statistic| p.value|\n|:--------------------|--------:|---------:|---------:|-------:|\n|(Intercept)          |  -0.3753|    0.2076|   -1.8081|  0.0706|\n|age                  |   0.0699|    0.0079|    8.8981|  0.0000|\n|I(age^2)             |  -0.0007|    0.0001|   -9.5756|  0.0000|\n|locationDavaoRegion  |  -0.0219|    0.0625|   -0.3501|  0.7262|\n|locationIlocosRegion |   0.0577|    0.0615|    0.9391|  0.3477|\n|locationMetroManila  |   0.0562|    0.0551|    1.0213|  0.3071|\n|locationVisayas      |   0.1104|    0.0487|    2.2654|  0.0235|\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}