{
  "hash": "1056db2db66c9aabcfce30bb4c0685e9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 20: Multilevel generalized linear models\"\ndate: \"2024-03-31\"\nfig_height: 3\nfig_width: 5\nexecute:\n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(lme4)\nlibrary(broom.mixed)\nlibrary(viridis)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbasketball <- read_csv(\"data/basketball0910.csv\")\n```\n:::\n\n\nSee [Section 11.1: Multilevel generalized linear models](https://bookdown.org/roback/bookdown-BeyondMLR/ch-GLMM.html) for the full codebook.\n\n# Exploratory data analysis\n\n## Univariate EDA\n\n::: callout-note\n## Exercise 1\n\nMake a table or visualization of the distribution of the response variable,`foul.home`. What proportion of fouls are called on the home team?\n:::\n\n::: callout-note\n## Exercise 2\n\nA histogram of the primary predictor of interest, `foul.diff` is below. Describe the distribution. Based on this, does it appear referees try to even out fouls called on the home and visiting teams?\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = basketball, aes(x = foul.diff)) + \n  geom_histogram(binwidth = 1, color = \"black\", fill = \"steelblue\") + \n  labs(x = \"Difference = Home - Visitor\", \n       title = \"Distribution of difference in fouls\", \n       subtitle = \"before current foul was called\")\n```\n\n::: {.cell-output-display}\n![](lec-20-multilevel-glm_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n## Exercise 3\n\nBelow is the average total number of fouls in all games in which a given team was the home team.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbasketball |>\n  group_by(hometeam, game) |>\n  summarise(total_fouls = sum(foul.home, foul.vis)) |>\n  group_by(hometeam) |>\n  summarise(avg_foul = sum(total_fouls) / n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 39 × 2\n   hometeam avg_foul\n   <chr>       <dbl>\n 1 BC           15.1\n 2 CIN          12.2\n 3 CLEM         15.5\n 4 CT           15  \n 5 DEPAUL       13.4\n 6 DUKE         20  \n 7 FLST         16.6\n 8 GATECH       17.5\n 9 GTOWN        13.8\n10 IA           12.1\n# ℹ 29 more rows\n```\n\n\n:::\n:::\n\n\n::: callout-note\n## Exercise 4\n\n-   The most total number fouls were called, on average, when which team was the home team? How many fouls were called on average?\n\n-   The least total number fouls were called, on average, when which team was the home team? How many fouls were called on average?\n\n-   Does this support including a random effect for home team in the model? Explain.\n:::\n\n## Bivariate EDA\n\n::: callout-note\n## Exercise 5\n\nBelow is a conditional density plot of `score.diff`, the score differential before the foul was called versus the response variable `foul.home`. Describe the relationship between score differential and the probability a foul called was on the home team.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = basketball, aes(x = score.diff, fill = factor(foul.home))) + \n  geom_density(position = \"fill\", adjust = 2, alpha = 0.7) + \n  labs(x = \"Score difference (home - visitor)\", \n       y = \"Probability of home foul\", \n       fill = \"Home foul\",\n       title = \"Score difference vs. probability of home foul\") + \n  scale_fill_viridis_d(end = 0.9)\n```\n\n::: {.cell-output-display}\n![](lec-20-multilevel-glm_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n## Exercise 6\n\nMake a conditional density plot of `foul.diff` versus the response variable `foul.home`. Describe the relationship between foul differential and the probability a foul called was on the home team.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# conditional density plot\n```\n:::\n\n\n::: callout-note\n## Exercise 7\n\nMake an empirical logit plot of `foul.diff` versus the logit of `foul.home`. Based on this plot, is the logit link function appropriate to model this data?\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# empirical logit \n```\n:::\n\n\n# Multilevel model\n\n## Original model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1 <- glmer(foul.home ~ foul.diff + (foul.diff|game), \n                data = basketball, family = binomial)\ntidy(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 7\n  effect   group term                     estimate std.error statistic   p.value\n  <chr>    <chr> <chr>                       <dbl>     <dbl>     <dbl>     <dbl>\n1 fixed    <NA>  (Intercept)               -0.157     0.0464     -3.38  7.19e- 4\n2 fixed    <NA>  foul.diff                 -0.285     0.0383     -7.44  1.01e-13\n3 ran_pars game  sd__(Intercept)            0.542    NA          NA    NA       \n4 ran_pars game  cor__(Intercept).foul.d…  -1        NA          NA    NA       \n5 ran_pars game  sd__foul.diff              0.0351   NA          NA    NA       \n```\n\n\n:::\n:::\n\n\n## Reparameterize model\n\n::: callout-note\n## Exercise 8\n\nWhich term(s) should we remove to try to address boundary constraint?\n:::\n\n::: callout-note\n## Exercise 9\n\nRefit the model with these terms removed. Call this `model2`.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# refit model \n```\n:::\n\n\n::: callout-note\nWhich model do you choose - model1 or model2? Explain.\n:::\n\n## Interpret coefficients\n\nInterpret the applicable coefficients in the selected model:\n\n-   $\\hat{\\alpha}_0$:\n\n-   $\\hat{\\beta}_0$:\n\n-   $\\hat{\\sigma}_u$:\n\n-   $\\hat{\\sigma}_v$:\n\n-   $\\hat{\\rho}_{uv}$:\n",
    "supporting": [
      "lec-20-multilevel-glm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}