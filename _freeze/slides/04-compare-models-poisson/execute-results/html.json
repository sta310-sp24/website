{
  "hash": "bc8536caeb0a45c9f5dca0379da5bba5",
  "result": {
    "markdown": "---\ntitle: \"Comparing models using likelihoods\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2024-01-24\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[üîó STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n## Announcements\n\n-   HW 01 due Wednesday at 11:59pm. Grace period (i.e., no late penalty) until Thursday, January 25 at 6am.\n    -   Your access to the repo will be removed at the end of the grace period. If you wish to submit the HW late, please email me and I will extend your access to the repo.\n    -   You will have access to your HW repo again when grades are returned.\n\n## Computing set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(GGally)\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(viridis)\nlibrary(ggfortify)\n\nggplot2::theme_set(ggplot2::theme_bw(base_size = 16))\ncolors <- tibble::tibble(green = \"#B5BA72\")\n```\n:::\n\n\n## Topics\n\n-   Comparing models using likelihood functions\n\n::: aside\nNotes based on Chapter 1 and 2 of @roback2021beyond unless noted otherwise.\n:::\n\n## Data: Fouls in college basketball games {.midi}\n\nThe data set [`04-refs.csv`](data/04-refs.csv) includes 30 randomly selected NCAA men's basketball games played in the 2009 - 2010 season.[^1]\n\n[^1]: The dataset was derived from `basektball0910.csv` used in [BMLR Section 11.2](https://bookdown.org/roback/bookdown-BeyondMLR/ch-GLMM.html#cs:refs)\n\nWe will focus on the variables `foul1`, `foul2`, and `foul3`, which indicate which team had a foul called them for the 1st, 2nd, and 3rd fouls, respectively.\n\n-   `H`: Foul was called on the home team\n-   `V`: Foul was called on the visiting team\n\nWe are focusing on the first three fouls for this analysis, but this could easily be extended to include all fouls in a game.\n\n## Fouls in college basketball games\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrefs <- read_csv(\"data/04-refs.csv\")\nrefs |> slice(1:5) |> kable()\n```\n\n::: {.cell-output-display}\n| game|     date|visitor |hometeam |foul1 |foul2 |foul3 |\n|----:|--------:|:-------|:--------|:-----|:-----|:-----|\n|  166| 20100126|CLEM    |BC       |V     |V     |V     |\n|  224| 20100224|DEPAUL  |CIN      |H     |H     |V     |\n|  317| 20100109|MARQET  |NOVA     |H     |H     |H     |\n|  214| 20100228|MARQET  |SETON    |V     |V     |H     |\n|  278| 20100128|SETON   |SFL      |H     |V     |V     |\n:::\n:::\n\n\nWe will treat the games as independent in this analysis.\n\n## Different likelihood models\n\n**Model 1 (Unconditional Model)**:\n\n-   What is the probability the referees call a foul on the home team, assuming foul calls within a game are independent?\n\n. . .\n\n**Model 2 (Conditional Model)**:\n\n-   Is there a tendency for the referees to call more fouls on the visiting team or home team?\n\n-   Is there a tendency for referees to call a foul on the team that already has more fouls?\n\n. . .\n\n**Ultimately we want to decide which model is better.**\n\n## Exploratory data analysis {.midi}\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrefs |>\ncount(foul1, foul2, foul3) |> kable()\n```\n\n::: {.cell-output-display}\n|foul1 |foul2 |foul3 |  n|\n|:-----|:-----|:-----|--:|\n|H     |H     |H     |  3|\n|H     |H     |V     |  2|\n|H     |V     |H     |  3|\n|H     |V     |V     |  7|\n|V     |H     |H     |  7|\n|V     |H     |V     |  1|\n|V     |V     |H     |  5|\n|V     |V     |V     |  2|\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\nThere are\n\n-   46 total fouls on the home team\n-   44 total fouls on the visiting team\n:::\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n## Maximum likelihood estimates {.midi}\n\nThe **maximum likelihood estimate (MLE)** is the value between 0 and 1 where we are most likely to see the observed data.\n\n. . .\n\n::: columns\n::: {.column width=\"50%\"}\n**Model 1 (Unconditional Model)**\n\n-   $\\hat{p}_H = 46/90 = 0.511$\n:::\n\n::: {.column width=\"50%\"}\n**Model 2 (Conditional Model)**\n\n-   $\\hat{p}_{H|N} = 25 / 48 = 0.521$\n-   $\\hat{p}_{H|H Bias} = 8 /20 = 0.4$\n-   $\\hat{p}_{H|V Bias} = 13/ 22 = 0.591$\n:::\n:::\n\n. . .\n\n-   What is the probability the referees call a foul on the home team, assuming foul calls within a game are independent?\n-   Is there a tendency for the referees to call more fouls on the visiting team or home team?\n-   Is there a tendency for referees to call a foul on the team that already has more fouls?\n\n## Model comparisons\n\n-   Nested models\n\n-   Non-nested models\n\n# Comparing nested models\n\n## Nested Models {.midi}\n\n**Nested models**: Models such that the parameters of the reduced model are a subset of the parameters for a larger model\n\nExample:\n\n$$\\begin{aligned}&\\text{Model A: }y = \\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\epsilon\\\\\n&\\text{Model B: }y = \\beta_0 + \\beta_1 x_1 + \\beta_2 x_2 + \\beta_3 x_3 + \\beta_4 x_4 + \\epsilon\\end{aligned}$$\n\n. . .\n\nModel A is nested in Model B. We could use likelihoods to test whether it is useful to add $x_3$ and $x_4$ to the model.\n\n. . .\n\n$$\\begin{aligned}&H_0: \\beta_3 = \\beta_4 = 0 \\\\ \n&H_a: \\text{ at least one }\\beta_j \\text{ is not equal to 0}\\end{aligned}$$\n\n## Nested models {.midi}\n\n**Another way to think about nested models**: Parameters in larger model can be equated to get the simpler model or if some parameters can be set to constants\n\n**Example:**\n\n$$\\begin{aligned}&\\text{Model 1: }p_H \\\\\n&\\text{Model 2: }p_{H| N}, p_{H| H Bias}, p_{H| V Bias}\\end{aligned}$$\n\n. . .\n\nModel 1 is nested in Model 2. The parameters $p_{H| N}$, $p_{H|H Bias}$, and $p_{H |V Bias}$ can be set equal to $p_H$ to get Model 1.\n\n. . .\n\n$$\\begin{aligned}&H_0: p_{H| N} = p_{H| H Bias} = p_{H| V Bias} = p_H \\\\\n&H_a: \\text{At least one of }p_{H| N}, p_{H| H Bias}, p_{H| V Bias} \\text{ differs from the others}\\end{aligned}$$\n\n## Steps to compare models\n\n1Ô∏è‚É£ Find the MLEs for each model.\n\n2Ô∏è‚É£ Plug the MLEs into the log-likelihood function for each model to get the maximum value of the log-likelihood for each model.\n\n3Ô∏è‚É£ Find the difference in the maximum log-likelihoods\n\n4Ô∏è‚É£ Use the Likelihood Ratio Test to determine if the difference is statistically significant\n\n## Steps 1 - 2\n\nFind the MLEs for each model and plug them into the log-likelihood functions.\n\n::: columns\n::: {.column width=\"50%\"}\n**Model 1:**\n\n-   $\\hat{p}_H = 46/90 = 0.511$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nloglik1 <- function(ph){\n log(ph^46 * (1 - ph)^44)\n}\nloglik1(46/90)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -62.36102\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n**Model 2**\n\n-   $\\hat{p}_{H|N} = 25 / 48 = 0.521$\n-   $\\hat{p}_{H|H Bias} = 8 /20 = 0.4$\n-   $\\hat{p}_{H|V Bias} = 13/ 22 = 0.591$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nloglik2 <- function(phn, phh, phv) {\n  log(phn^25 * (1 - phn)^23 * phh^8 * \n        (1 - phh)^12 * phv^13 * (1 - phv)^9)\n}\nloglik2(25/48, 8/20, 13/22)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -61.57319\n```\n:::\n:::\n\n:::\n:::\n\n## Step 3\n\nFind the difference in the log-likelihoods\n\n$$\n\\log(Lik(Model 2)) - \\log(Lik(Model1))\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(diff <- loglik2(25/48, 8/20, 13/22) - loglik1(46/90))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7878318\n```\n:::\n:::\n\n\n<br>\n\n. . .\n\n<center>**Is the difference in the maximum log-likelihoods statistically significant?**</center>\n\n## Likelihood Ratio Test {.midi}\n\n**Test statistic**\n\n$$\\begin{aligned} LRT &= 2[\\max\\{\\log(Lik(\\text{larger model}))\\} - \\max\\{\\log(Lik(\\text{reduced model}))\\}]\\\\[10pt]\n&= 2\\log\\Bigg(\\frac{\\max\\{(Lik(\\text{larger model})\\}}{\\max\\{(Lik(\\text{reduced model})\\}}\\Bigg)\\end{aligned}$$\n\n<br>\n\n. . .\n\nLRT follows a $\\chi^2$ distribution where the degrees of freedom equal the difference in the number of parameters between the two models\n\n## Step 4\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(LRT <- 2 * (loglik2(25/48, 8/20, 13/22) - loglik1(46/90)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.575664\n```\n:::\n:::\n\n\n. . .\n\nThe test statistic follows a $\\chi^2$ distribution with 2 degrees of freedom. Therefore, the p-value is $P(\\chi^2 > LRT)$.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npchisq(LRT, 2, lower.tail = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4548299\n```\n:::\n:::\n\n\n. . .\n\nThe p-value is very large, so we fail to reject $H_0$. We do not have convincing evidence that the conditional model is an improvement over the unconditional model. Therefore, we can stick with the unconditional model.\n\n# Comparing non-nested models\n\n## Comparing non-nested models {.midi}\n\n::: columns\n::: {.column width=\"50%\"}\nAIC = -2(max logLik) + 2p\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(Model1_AIC <- 2 * loglik1(46/90) + 2 * 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -122.722\n```\n:::\n\n```{.r .cell-code}\n(Model2_AIC <-2 * loglik2(25/48, 8/20, 13/22) + 2 * 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -117.1464\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\nBIC = -2(max logLik) + plog(n)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(Model1_BIC <- 2 * loglik1(46/90) + 1 * log(30))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -121.3208\n```\n:::\n\n```{.r .cell-code}\n(Model2_BIC <-2 * loglik2(25/48, 8/20, 13/22) + 3 * log(30))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -112.9428\n```\n:::\n:::\n\n:::\n:::\n\n<br>\n\n. . .\n\n**Choose Model 1, the unconditional model, based on AIC and BIC**\n\n## Looking ahead {.midi}\n\n-   Likelihoods help us answer the question of how likely we are to observe the data given different parameters\n\n-   In this example, we did not consider covariates, so in practice the parameters we want to estimate will look more similar to this\n\n$$p_H = \\frac{e^{\\beta_0 + \\beta_1x_1 + \\dots + \\beta_px_p}}{1 + e^{\\beta_0 + \\beta_1x_1 + \\dots + \\beta_px_p}}$$\n\n-   Finding the MLE becomes much more complex and numerical methods may be required.\n    -   We will primarily rely on software to find the MLE, but the conceptual ideas will be the same\n\n## References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}