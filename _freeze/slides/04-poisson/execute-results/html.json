{
  "hash": "6146252cefeac0d0c9cef44681b4f8f4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Poisson Regression\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2024-01-24\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[🔗 STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n## Computing set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(viridis)\nlibrary(gridExtra)\n\n\nggplot2::theme_set(ggplot2::theme_bw(base_size = 16))\n\ncolors <- tibble::tibble(green = \"#B5BA72\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n## Topics\n\n-   Describe properties of the Poisson random variable\n\n-   Write the mathematical equation of the Poisson regression model\n\n-   Describe how the Poisson regression differs from least-squares regression\n\n-   Interpret the coefficients for the Poisson regression model\n\n-   Compare two Poisson regression models\n\n::: aside\nNotes based on Section 4.4 - 4.5, and 4.9 of @roback2021beyond unless noted otherwise.\n:::\n\n## Scenarios to use Poisson regression\n\n-   Does the number of employers conducting on-campus interviews during a year differ for public and private colleges?\n\n-   Does the daily number of asthma-related visits to an Emergency Room differ depending on air pollution indices?\n\n-   Does the number of paint defects per square foot of wall differ based on the years of experience of the painter?\n\n## Scenarios to use Poisson regression\n\n-   Does the **number of employers conducting on-campus interviews during a year** differ for public and private colleges?\n\n-   Does the **daily number of asthma-related visits to an Emergency Room** differ depending on air pollution indices?\n\n-   Does the number of paint defects per square foot of wall differ based on the years of experience of the painter?\n\n<br>\n\n. . .\n\nEach response variable is a **count per a unit of time or space.**\n\n## Poisson distribution {.midi}\n\nLet $Y$ be the number of events in a given unit of time or space. Then $Y$ can be modeled using a **Poisson distribution**\n\n$$P(Y=y) = \\frac{e^{-\\lambda}\\lambda^y}{y!} \\hspace{10mm} y=0,1,2,\\ldots, \\infty$$\n\n. . .\n\n**Features**\n\n-   $E(Y) = Var(Y) = \\lambda$\n-   The distribution is typically skewed right, particularly if $\\lambda$ is small\n-   The distribution becomes more symmetric as $\\lambda$ increases\n    -   If $\\lambda$ is sufficiently large, it can be approximated using a normal distribution ([Click here](https://online.stat.psu.edu/stat414/lesson/28/28.2) for an example.)\n\n------------------------------------------------------------------------\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=60%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Variance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 1 </td>\n   <td style=\"text-align:right;\"> 0.99351 </td>\n   <td style=\"text-align:right;\"> 0.9902178 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 5 </td>\n   <td style=\"text-align:right;\"> 4.99367 </td>\n   <td style=\"text-align:right;\"> 4.9865798 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 50 </td>\n   <td style=\"text-align:right;\"> 49.99288 </td>\n   <td style=\"text-align:right;\"> 49.8962683 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Example[^1] {.midi}\n\n[^1]: Example adapted from [Introduction to Probability Theory Example 28-2](https://online.stat.psu.edu/stat414/lesson/28/28.2)\n\nThe annual number of earthquakes registering at least 2.5 on the Richter Scale and having an epicenter within 40 miles of downtown Memphis follows a Poisson distribution with mean 6.5. **What is the probability there will be at 3 or fewer such earthquakes next year?**\n\n. . .\n\n$$P(Y \\leq 3) = P(Y = 0) + P(Y = 1) + P(Y = 2) + P(Y = 3)$$\n\n. . .\n\n$$ = \\frac{e^{-6.5}6.5^0}{0!} + \\frac{e^{-6.5}6.5^1}{1!} + \\frac{e^{-6.5}6.5^2}{2!} + \\frac{e^{-6.5}6.5^3}{3!}$$\n\n$$ = 0.112$$\n\n. . .\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nppois(3, 6.5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1118496\n```\n\n\n:::\n:::\n\n\n# Poisson regression\n\n## The data: Household size in the Philippines {.midi}\n\nThe data [fHH1.csv](data/fHH1.csv) come from the 2015 Family Income and Expenditure Survey conducted by the Philippine Statistics Authority.\n\n**Goal**: Understand the association between household size and various characteristics of the household\n\n**Response**:\n\n-   `total`: Number of people in the household other than the head\n\n::: columns\n::: {.column width=\"50%\"}\n**Predictors**:\n\n-   `location`: Where the house is located\n-   `age`: Age of the head of household\n-   `roof`: Type of roof on the residence (proxy for wealth)\n:::\n\n::: {.column width=\"50%\"}\n**Other variables**:\n\n-   `numLT5`: Number in the household under 5 years old\n:::\n:::\n\n## The data {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhh_data <- read_csv(\"data/fHH1.csv\")\nhh_data |> slice(1:5) |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|location     | age| total| numLT5|roof                          |\n|:------------|---:|-----:|------:|:-----------------------------|\n|CentralLuzon |  65|     0|      0|Predominantly Strong Material |\n|MetroManila  |  75|     3|      0|Predominantly Strong Material |\n|DavaoRegion  |  54|     4|      0|Predominantly Strong Material |\n|Visayas      |  49|     3|      0|Predominantly Strong Material |\n|MetroManila  |  74|     3|      0|Predominantly Strong Material |\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Response variable\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|  mean|   var|\n|-----:|-----:|\n| 3.685| 5.534|\n\n\n:::\n:::\n\n\n## Why the least-squares model doesn't work {.midi}\n\nThe goal is to model $\\lambda$, the expected number of people in the household (other than the head), as a function of the predictors (covariates)\n\n. . .\n\nWe might be tempted to try a linear model $$\\lambda_i = \\beta_0 + \\beta_1x_{i1} + \\beta_2x_{i2} + \\dots + \\beta_px_{ip}$$\n\n. . .\n\nThis model won't work because...\n\n-   It could produce negative values of $\\lambda$ for certain values of the predictors\n-   The equal variance assumption required to conduct inference for linear regression is violated.\n\n## Poisson regression model\n\nIf $Y_i \\sim Poisson$ with $\\lambda = \\lambda_i$ for the given values $x_{i1}, \\ldots, x_{ip}$, then\n\n$$\\log(\\lambda_i) = \\beta_0 + \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\dots + \\beta_p x_{ip}$$\n\n. . .\n\n-   Each observation can have a different value of $\\lambda$ based on its value of the predictors $x_1, \\ldots, x_p$\n\n-   $\\lambda$ determines the mean and variance, so we don't need to estimate a separate error term\n\n## Poisson vs. multiple linear regression\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Regression models: Linear regression (left) and Poisson regression (right).](04-poisson_files/figure-revealjs/OLSpois-1.png){fig-align='center' width=60%}\n:::\n:::\n\n\n::: aside\nFigures recreated from [BMLR Figure 4.1](https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html#a-graphical-look-at-poisson-regression)\n:::\n\n## Assumptions for Poisson regression {.small}\n\n::: columns\n::: {.column width=\"50%\"}\n**Poisson response**: The response variable is a count per unit of time or space, described by a Poisson distribution, at each level of the predictor(s)\n\n**Independence**: The observations must be independent of one another\n\n**Mean = Variance**: The mean must equal the variance\n\n**Linearity**: The log of the mean rate, $\\log(\\lambda)$, must be a linear function of the predictor(s)\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=100%}\n:::\n:::\n\n:::\n:::\n\n## Model 1: Household vs. Age\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel1 <- glm(total ~ age, data = hh_data, family = poisson)\n\ntidy(model1) |> \n  kable(digits = 4)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|\n\n\n:::\n:::\n\n\n$$\\log(\\hat{\\lambda}) = 1.5499  - 0.0047 ~ age$$\n\n------------------------------------------------------------------------\n\n::: question\nThe coefficient for `age` is -0.0047. Interpret this coefficient in context. Select all that apply.\n\n1.  The mean household size is predicted to decrease by 0.0047 for each year older the head of the household is.\n\n2.  The mean household size is predicted to multiply by a factor of 0.9953 for each year older the head of the household is.\n\n3.  The mean household size is predicted to decrease by 0.9953 for each year older the head of the household is.\n\n4.  The mean household size is predicted to multiply by a factor of 0.47% for each year older the head of the household is.\n\n5.  The mean household size is predicted to decrease by 0.47% for each year older the head of the household is.\n:::\n\n## Is the coefficient of `age` statistically significant? {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|   1.4512|    1.6482|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|  -0.0065|   -0.0029|\n\n\n:::\n:::\n\n\n$$H_0: \\beta_1 = 0 \\hspace{2mm} \\text{ vs. } \\hspace{2mm} H_a: \\beta_1 \\neq 0$$\n\n. . .\n\n**Test statistic**\n\n$$Z = \\frac{\\hat{\\beta}_1 - 0}{SE(\\hat{\\beta}_1)} = \\frac{-0.0047 - 0}{0.0009} = -5.026 \\text{ (using exact values)}$$\n\n. . .\n\n**P-value**\n\n$$P(|Z| > |-5.026|) = 5.01 \\times 10^{-7} \\approx 0$$\n\n## What are plausible values for the coefficient of `age`? {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|   1.4512|    1.6482|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|  -0.0065|   -0.0029|\n\n\n:::\n:::\n\n\n**95% confidence interval for the coefficient of `age`**\n\n$$\\hat{\\beta}_1 \\pm z^{*}\\times SE(\\hat{\\beta}_1)$$\n\nwhere $z^* \\sim N(0, 1)$ $$-0.0047 \\pm 1.96 \\times 0.0009 = \\mathbf{(-.0065, -0.0029)}$$\n\n::: question\nInterpret the interval in terms of the change in mean household size.\n:::\n\n## **Which plot can best help us determine whether Model 1 is a good fit?**\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## Model 2: Add a quadratic effect for `age`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhh_data <- hh_data |> \n  mutate(age2 = age*age)\n\nmodel2 <- glm(total ~ age + age2, data = hh_data, family = poisson)\ntidy(model2, conf.int = T) |> \n  kable(digits = 4)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |  -0.3325|    0.1788|   -1.8594|   0.063|  -0.6863|    0.0148|\n|age         |   0.0709|    0.0069|   10.2877|   0.000|   0.0575|    0.0845|\n|age2        |  -0.0007|    0.0001|  -11.0578|   0.000|  -0.0008|   -0.0006|\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Model 2: Add a quadratic effect for `age`\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |  -0.3325|    0.1788|   -1.8594|   0.063|  -0.6863|    0.0148|\n|age         |   0.0709|    0.0069|   10.2877|   0.000|   0.0575|    0.0845|\n|age2        |  -0.0007|    0.0001|  -11.0578|   0.000|  -0.0008|   -0.0006|\n\n\n:::\n:::\n\n\nWe can determine whether to keep $age^2$ in the model in two ways:\n\n1️⃣ Use the p-value (or confidence interval) for the coefficient (since we are adding a single term to the model)\n\n2️⃣ Conduct a drop-in-deviance test\n\n## Deviance\n\nA **deviance** is a way to measure how the observed data differs (deviates) from the model predictions.\n\n-   It's a measure unexplained variability in the response variable (similar to SSE in linear regression )\n\n-   Lower deviance means the model is a better fit to the data\n\n. . .\n\nWe can calculate the \"deviance residual\" for each observation in the data (more on the formula later). Let $(\\text{deviance residual}_i$ be the deviance residual for the $i^{th}$ observation, then\n\n$$\\text{deviance} = \\sum(\\text{deviance residual})_i^2$$\n\n*Note: Deviance is also known as the \"residual deviance\"*\n\n------------------------------------------------------------------------\n\n## Drop-in-Deviance Test {.midi}\n\nWe can use a **drop-in-deviance test** to compare two models. To conduct the test\n\n1️⃣ Compute the deviance for each model\n\n2️⃣ Calculate the drop in deviance\n\n$$\\text{drop-in-deviance =  Deviance(reduced model) - Deviance(larger model)}$$\n\n3️⃣ Given the reduced model is the true model $(H_0 \\text{ true})$, then $$\\text{drop-in-deviance} \\sim \\chi_d^2$$\n\nwhere $d$ is the difference in degrees of freedom between the two models (i.e., the difference in number of terms)\n\n## Drop-in-deviance to compare Model1 and Model2\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(model1, model2, test = \"Chisq\") |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n| Resid. Df| Resid. Dev| Df| Deviance| Pr(>Chi)|\n|---------:|----------:|--:|--------:|--------:|\n|      1498|   2337.089| NA|       NA|       NA|\n|      1497|   2200.944|  1|  136.145|        0|\n\n\n:::\n:::\n\n\n::: question\na.  Write the null and alternative hypotheses.\nb.  What does the value 2337.089 tell you?\nc.  What does the value 1 tell you?\nd.  What is your conclusion?\n:::\n\n## Add `location` to the model? {.midi}\n\nSuppose we want to add `location` to the model, so we compare the following models:\n\n**Model A**: $\\lambda_i = \\beta_0 + \\beta_1 ~ age_i + \\beta_2 ~ age_i^2$\n\n**Model B**: $\\lambda_i = \\beta_0 + \\beta_1 ~ age_i + \\beta_2 ~ age_i^2 + \\beta_3 ~ Loc1_i + \\beta_4 ~ Loc2_i + \\beta_5 ~ Loc3_i + \\beta_6 ~ Loc4_i$\n\n::: question\nWhich of the following are reliable ways to determine if `location` should be added to the model?\n\n1.  Drop-in-deviance test\n2.  Use the p-value for each coefficient\n3.  Likelihood ratio test\n4.  Nested F Test\n5.  BIC\n:::\n\n## Looking ahead\n\n-   For next time - [Chapter 4 - Poisson Regression](https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html)\n    -   Sections 4.6, 4.10\n\n## References\n",
    "supporting": [
      "04-poisson_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}