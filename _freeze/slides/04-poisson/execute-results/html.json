{
  "hash": "c1f46b56536b05d78e15495fad0a7389",
  "result": {
    "markdown": "---\ntitle: \"Poisson Regression\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2024-01-24\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n## Computing set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(patchwork)\nlibrary(viridis)\nlibrary(gridExtra)\n\n\nggplot2::theme_set(ggplot2::theme_bw(base_size = 16))\n\ncolors <- tibble::tibble(green = \"#B5BA72\")\n```\n:::\n\n\n------------------------------------------------------------------------\n\n## Topics\n\n-   Describe properties of the Poisson random variable\n\n-   Write the mathematical equation of the Poisson regression model\n\n-   Describe how the Poisson regression differs from least-squares regression\n\n-   Interpret the coefficients for the Poisson regression model\n\n-   Compare two Poisson regression models\n\n::: aside\nNotes based on Section 4.4 - 4.5, and 4.9 of @roback2021beyond unless noted otherwise.\n:::\n\n## Scenarios to use Poisson regression\n\n-   Does the number of employers conducting on-campus interviews during a year differ for public and private colleges?\n\n-   Does the daily number of asthma-related visits to an Emergency Room differ depending on air pollution indices?\n\n-   Does the number of paint defects per square foot of wall differ based on the years of experience of the painter?\n\n## Scenarios to use Poisson regression\n\n-   Does the **number of employers conducting on-campus interviews during a year** differ for public and private colleges?\n\n-   Does the **daily number of asthma-related visits to an Emergency Room** differ depending on air pollution indices?\n\n-   Does the number of paint defects per square foot of wall differ based on the years of experience of the painter?\n\n<br>\n\n. . .\n\nEach response variable is a **count per a unit of time or space.**\n\n## Poisson distribution {.midi}\n\nLet $Y$ be the number of events in a given unit of time or space. Then $Y$ can be modeled using a **Poisson distribution**\n\n$$P(Y=y) = \\frac{e^{-\\lambda}\\lambda^y}{y!} \\hspace{10mm} y=0,1,2,\\ldots, \\infty$$\n\n. . .\n\n**Features**\n\n-   $E(Y) = Var(Y) = \\lambda$\n-   The distribution is typically skewed right, particularly if $\\lambda$ is small\n-   The distribution becomes more symmetric as $\\lambda$ increases\n    -   If $\\lambda$ is sufficiently large, it can be approximated using a normal distribution ([Click here](https://online.stat.psu.edu/stat414/lesson/28/28.2) for an example.)\n\n------------------------------------------------------------------------\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=60%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Variance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 1 </td>\n   <td style=\"text-align:right;\"> 0.99351 </td>\n   <td style=\"text-align:right;\"> 0.9902178 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 5 </td>\n   <td style=\"text-align:right;\"> 4.99367 </td>\n   <td style=\"text-align:right;\"> 4.9865798 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> lambda = 50 </td>\n   <td style=\"text-align:right;\"> 49.99288 </td>\n   <td style=\"text-align:right;\"> 49.8962683 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Example[^1] {.midi}\n\n[^1]: Example adapted from [Introduction to Probability Theory Example 28-2](https://online.stat.psu.edu/stat414/lesson/28/28.2)\n\nThe annual number of earthquakes registering at least 2.5 on the Richter Scale and having an epicenter within 40 miles of downtown Memphis follows a Poisson distribution with mean 6.5. **What is the probability there will be at 3 or fewer such earthquakes next year?**\n\n. . .\n\n$$P(Y \\leq 3) = P(Y = 0) + P(Y = 1) + P(Y = 2) + P(Y = 3)$$\n\n. . .\n\n$$ = \\frac{e^{-6.5}6.5^0}{0!} + \\frac{e^{-6.5}6.5^1}{1!} + \\frac{e^{-6.5}6.5^2}{2!} + \\frac{e^{-6.5}6.5^3}{3!}$$\n\n$$ = 0.112$$\n\n. . .\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nppois(3, 6.5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1118496\n```\n:::\n:::\n\n\n# Poisson regression\n\n## The data: Household size in the Philippines {.midi}\n\nThe data [fHH1.csv](data/fHH1.csv) come from the 2015 Family Income and Expenditure Survey conducted by the Philippine Statistics Authority.\n\n**Goal**: Understand the association between household size and various characteristics of the household\n\n**Response**:\n\n-   `total`: Number of people in the household other than the head\n\n::: columns\n::: {.column width=\"50%\"}\n**Predictors**:\n\n-   `location`: Where the house is located\n-   `age`: Age of the head of household\n-   `roof`: Type of roof on the residence (proxy for wealth)\n:::\n\n::: {.column width=\"50%\"}\n**Other variables**:\n\n-   `numLT5`: Number in the household under 5 years old\n:::\n:::\n\n## The data {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhh_data <- read_csv(\"data/fHH1.csv\")\nhh_data |> slice(1:5) |> kable()\n```\n\n::: {.cell-output-display}\n|location     | age| total| numLT5|roof                          |\n|:------------|---:|-----:|------:|:-----------------------------|\n|CentralLuzon |  65|     0|      0|Predominantly Strong Material |\n|MetroManila  |  75|     3|      0|Predominantly Strong Material |\n|DavaoRegion  |  54|     4|      0|Predominantly Strong Material |\n|Visayas      |  49|     3|      0|Predominantly Strong Material |\n|MetroManila  |  74|     3|      0|Predominantly Strong Material |\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Response variable\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|  mean|   var|\n|-----:|-----:|\n| 3.685| 5.534|\n:::\n:::\n\n\n## Why the least-squares model doesn't work {.midi}\n\nThe goal is to model $\\lambda$, the expected number of people in the household (other than the head), as a function of the predictors (covariates)\n\n. . .\n\nWe might be tempted to try a linear model $$\\lambda_i = \\beta_0 + \\beta_1x_{i1} + \\beta_2x_{i2} + \\dots + \\beta_px_{ip}$$\n\n. . .\n\nThis model won't work because...\n\n-   It could produce negative values of $\\lambda$ for certain values of the predictors\n-   The equal variance assumption required to conduct inference for linear regression is violated.\n\n## Poisson regression model\n\nIf $Y_i \\sim Poisson$ with $\\lambda = \\lambda_i$ for the given values $x_{i1}, \\ldots, x_{ip}$, then\n\n$$\\log(\\lambda_i) = \\beta_0 + \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\dots + \\beta_p x_{ip}$$\n\n. . .\n\n-   Each observation can have a different value of $\\lambda$ based on its value of the predictors $x_1, \\ldots, x_p$\n\n-   $\\lambda$ determines the mean and variance, so we don't need to estimate a separate error term\n\n## Poisson vs. multiple linear regression\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Regression models: Linear regression (left) and Poisson regression (right).](04-poisson_files/figure-revealjs/OLSpois-1.png){fig-align='center' width=60%}\n:::\n:::\n\n\n::: aside\nFigures recreated from [BMLR Figure 4.1](https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html#a-graphical-look-at-poisson-regression)\n:::\n\n## Assumptions for Poisson regression {.small}\n\n::: columns\n::: {.column width=\"50%\"}\n**Poisson response**: The response variable is a count per unit of time or space, described by a Poisson distribution, at each level of the predictor(s)\n\n**Independence**: The observations must be independent of one another\n\n**Mean = Variance**: The mean equals the variance\n\n**Linearity**: The log of the mean rate, $\\log(\\lambda)$, must be a linear function of the predictor(s)\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](04-poisson_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=100%}\n:::\n:::\n\n:::\n:::\n\n## Model 1: Household vs. Age\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmodel1 <- glm(total ~ age, data = hh_data, family = poisson)\n\ntidy(model1) |> \n  kable(digits = 4)\n```\n\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|\n:::\n:::\n\n\n$$\\log(\\hat{\\lambda}) = 1.5499  - 0.0047 ~ age$$\n\n------------------------------------------------------------------------\n\n::: question\nThe coefficient for `age` is -0.0047. Interpret this coefficient in context. Select all that apply.\n\n1.  The mean household size is predicted to decrease by 0.0047 for each year older the head of the household is.\n\n2.  The mean household size is predicted to multiply by a factor of 0.9953 for each year older the head of the household is.\n\n3.  The mean household size is predicted to decrease by 0.9953 for each year older the head of the household is.\n\n4.  The mean household size is predicted to multiply by a factor of 0.47% for each year older the head of the household is.\n\n5.  The mean household size is predicted to decrease by 0.47% for each year older the head of the household is.\n:::\n\n## Is the coefficient of `age` statistically significant? {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|   1.4512|    1.6482|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|  -0.0065|   -0.0029|\n:::\n:::\n\n\n$$H_0: \\beta_1 = 0 \\hspace{2mm} \\text{ vs. } \\hspace{2mm} H_a: \\beta_1 \\neq 0$$\n\n. . .\n\n**Test statistic**\n\n$$Z = \\frac{\\hat{\\beta}_1 - 0}{SE(\\hat{\\beta}_1)} = \\frac{-0.0047 - 0}{0.0009} = -5.026 \\text{ (using exact values)}$$\n\n. . .\n\n**P-value**\n\n$$P(|Z| > |-5.026|) = 5.01 \\times 10^{-7} \\approx 0$$\n\n## What are plausible values for the coefficient of `age`? {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |   1.5499|    0.0503|   30.8290|       0|   1.4512|    1.6482|\n|age         |  -0.0047|    0.0009|   -5.0258|       0|  -0.0065|   -0.0029|\n:::\n:::\n\n\n**95% confidence interval for the coefficient of `age`**\n\n$$\\hat{\\beta}_1 \\pm z^{*}\\times SE(\\hat{\\beta}_1)$$\n\nwhere $z^* \\sim N(0, 1)$ $$-0.0047 \\pm 1.96 \\times 0.0009 = \\mathbf{(-.0065, -0.0029)}$$\n\n::: question\nInterpret the interval in terms of the change in mean household size.\n:::\n\n# Estimating $\\beta_0$ and $\\beta_1$\n\n## Estimating $\\beta_0$ and $\\beta_1$ {.midi}\n\n-   1.5499 and -0.0047 are the estimates of $\\beta_0$ and $\\beta_1$ respectively.\n\n-   How were these values determined?\n\n-   Let's take a look at the first five rows of data:\n\n. . .\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|location     | age| total| numLT5|roof                          |\n|:------------|---:|-----:|------:|:-----------------------------|\n|CentralLuzon |  65|     0|      0|Predominantly Strong Material |\n|MetroManila  |  75|     3|      0|Predominantly Strong Material |\n|DavaoRegion  |  54|     4|      0|Predominantly Strong Material |\n|Visayas      |  49|     3|      0|Predominantly Strong Material |\n|MetroManila  |  74|     3|      0|Predominantly Strong Material |\n:::\n:::\n\n\n## Likelihood\n\nThen the likelihood for those five observations is\n\n$$Likelihood =P(Y_1 = 0)P(Y_2 = 3)P(Y_3 = 4)P(Y_4 = 3)P(Y_5 = 3)\n$$\n\n. . .\n\nThe Y's follow a Poisson distribution, so this equals\n\n$$\nLikelihood = \\frac{e^{-\\lambda_1}\\lambda_1^0}{0!} * \\frac{e^{-\\lambda_2}\\lambda_2^3}{3!} * \\frac{e^{-\\lambda_3}\\lambda_3^4}{4!} *\\frac{e^{-\\lambda_4}\\lambda_4^3}{3!} * \\frac{e^{-\\lambda_5}\\lambda_5^3}{3!}\n$$\n\nwhere $\\lambda_i$ can differ for each household based on its value of `age`.\n\n## Log-likelihood\n\nLet's take the log of the likelihood, as this will be easier to maximize than the likelihood itself.\n\n$$\n\\begin{align}\nlogL =& -\\lambda_1 + 0\\log(\\lambda_1) - \\lambda_2 + 3\\log(\\lambda_2) - \\lambda_3 + 4\\log(\\lambda_3)\\\\ &- \\lambda_4 + 3\\log(\\lambda_4) - \\lambda_5 + 3\\log(\\lambda_5) \\\\ &+ C\n\\end{align}\n$$\n\n::: callout-note\nWe are going to maximize with respect to $\\lambda$, we will drop the constant term $C$ moving forward.\n:::\n\n## Log-likelihood {.midi}\n\nBecause we're fitting a Poisson regression model, we know\n\n$$\n\\log(\\lambda_i) = \\beta_0 + \\beta_1~age_i \\hspace{6mm} and \\hspace{6mm} \\lambda_i = e^{\\beta_0 + \\beta_1~age_i}\n$$\n\n. . .\n\nPlugging these formulas and the respective ages into $logL$, we have\n\n\n```{=tex}\n\\begin{align}\nlogL \\propto& - \\exp^{\\beta_0 + \\beta_1*65} + 0*(\\beta_0 + \\beta_1*65)\\\\ \n&- \\exp^{\\beta_0 + \\beta_1*75} + 3*(\\beta_0 + \\beta_1*75)\\\\ \n&- \\exp^{\\beta_0 + \\beta_1*54} + 4*(\\beta_0 + \\beta_1*54)\\\\ \n& -\\exp^{\\beta_0 + \\beta_1*49}  + 3*(\\beta_0 + \\beta_1*49) \\\\\n&-\\exp^{\\beta_0 + \\beta_1*74} + 3*(\\beta_0 + \\beta_1*74) \n\\end{align}\n```\n\n## Log-likelihood\n\nExpanding this to the entire data set, we have\n\n$$\nlogL \\propto \\sum_{i=1}^{1500} -e^{\\beta_0 + \\beta_1age_i} + total_i (\\beta_0 + \\beta_1age_i)\n$$\n\n. . .\n\nCan use different numerical methods to try different values of $\\beta_0$ and $\\beta_1$ and find the combination that maximizes $logL$ .\n\n## Iteratively reweighted least-squares (IRLS)\n\n-   **Iteratively reweighted least-squares (IRLS)** is used to find the MLEs\n\n-   @nelder1972generalized show that under certain specifications of the weights and a modified response variable, the estimates found using IRLS are equivalent to the MLEs.\n\n## IRLS procedure {.midi}\n\n1.  Find initial starting values $\\hat{\\theta}_i$, the model parameter ( $\\hat{\\theta}_i = \\hat{\\lambda}_i$ in the case of Poisson regression)\n\n2.  Calculate the working response values $z_i$.\n\n3.  Calculate the working weights $W_i$.\n\n4.  Find the coefficient estimates of the weighted least squares model.\n\n$$z_i = \\beta_0 + \\beta_1 x \\hspace{5mm} \\text{ with weights }W_i$$\n\nThe estimates $\\hat{\\beta}_0$ and $\\hat{\\beta}_1$ are the estimates for the model coefficients.\n\n. . .\n\nUse $\\hat{\\beta}_0$ and $\\hat{\\beta}_1$ to calculate updated values of $\\hat{\\theta}_i$ and repeat steps 2 - 4 until convergence.\n\n::: aside\nSteps from @dunn2018generalized.\n:::\n\n## IRLS Set up {.midi}\n\n**Working response**: Modified response variable at each step of the iteration.\n\n$$z_i = g(\\theta) + g'(\\theta)(y_i - \\theta_i)$$\n\nwhere $g(\\theta)$ is the link function. (We will talk all about link functions in Chapter 5)\n\n. . .\n\nFor Poisson regression $g(\\theta) = \\log(\\lambda)$\n\n$$z_i = \\log(\\lambda) + \\frac{(y_i - \\lambda_i)}{\\lambda_i}$$\n\n. . .\n\n**Working Weights:** Weights applied to the observations at each step of the iteration\n\n$$W_i = \\frac{\\theta^2}{Var(Y)} \\hspace{5mm} \\Rightarrow \\hspace{5mm}  W_i = \\frac{\\lambda^2}{\\lambda} =  \\lambda \\text{ for Poisson regression}$$\n\n# Application exercise \n\n::: appex\nðŸ“‹ [sta310-sp24.netlify.app/ae/lec-04-poisson-estimate](../ae/lec-04-poisson-estimate.html)\n:::\n\n## Looking ahead\n\n-   For next time - [Chapter 4 - Poisson Regression](https://bookdown.org/roback/bookdown-BeyondMLR/ch-poissonreg.html)\n    -   Sections 4.6, 4.10\n\n## References\n",
    "supporting": [
      "04-poisson_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}