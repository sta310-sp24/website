{
  "hash": "44ec34424989ce43f22ad47c0c9df95a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Proportional odds + Probit regression\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"February 12, 2024\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n## Announcements\n\n-   Project 01\n\n    -   presentations in class Wed, Feb 14\n\n    -   write up due Thu, Feb 15 at 9pm\n\n-   Quiz 02: Tue, Feb 20 - Thu, Feb 22\n\n    -   Covers readings & lectures: Jan 24 - Feb 12\n\n    -   Poisson regression, unifying framework for GLMs, logistic regression, proportional odds models, probit regression\n\n## Learning goals\n\n-   Introduce proportional odds and probit regression models\n\n-   Understand how these models are related to logistic regression models\n\n-   Interpret coefficients in context of the data\n\n-   See how these models are applied in research contexts\n\n::: aside\nNotes based on Chapters 6 and 7 of @mcnulty2021handbook unless stated otherwise.\n:::\n\n# Proportional odds models\n\n## Predicting ED wait and treatment times\n\n@ataman2021predicting use ordinal logistic regression to predict patient wait and treatment times in an emergency department (ED). The goal is to identify relevant factors that can be used to inform recommendations for reducing wait and treatment times, thus improving the quality of care in the ED.\n\n**Data**: Daily records for ED arrivals in August 2018 at a public hospital in Izmir, Turkey.\\\n\n::: aside\n[Click here](https://canvas.duke.edu/courses/25310/files/folder/journal-articles?preview=897957) to access the article on Canvas.\n:::\n\n## Predicting ED wait and treatment times {.midi}\n\n**Response variables:**\n\n-   `Wait time`:\n\n    -   Patients who wait less than 10 minutes\n    -   Patients whose waiting time is in the range of 10 - 60 minutes\n    -   Patients who wait more than 60 minutes\n\n-   `Treatment time`:\n\n    -   Patients who are treated for up to 10 minutes\n\n    -   Patients whose treatment time is in the range of 10 - 120 minutes\n\n    -   Patients who are treated for longer than 120 minutes\n\n## Predicting ED wait and treatment times {.midi}\n\n**Predictor variables:**\n\n::: columns\n::: {.column width=\"50%\"}\n-   `Gender`:\n    -   Male\n    -   Female\n-   `Age`:\n    -   0 - 14\n    -   15 - 64\n    -   65 - 84\n    -   $\\geq$ 85\n-   `Arrival mode`:\n    -   Walk-in\n    -   Ambulance\n:::\n\n::: {.column width=\"50%\"}\n-   `Triage level`:\n\n    -   Red (urgent)\n    -   Green (non-urgent)\n\n-   `ICD-10 diagnosis`: Codes specifying patient's diagnosis\n:::\n:::\n\n## Ordered vs. unordered variables {.midi}\n\n**Categorical variables with 3+ levels**\n\n::: columns\n::: {.column width=\"50%\"}\n**Unordered (Nominal)**\n\n-   Voting choice in election with multiple candidates\n\n-   Type of cell phone owned by adults in the U.S.\n\n-   Favorite social media platform among undergraduate students\n:::\n\n::: {.column width=\"50%\"}\n**Ordered (Ordinal)**\n\n-   Wait and treatment times in the emergency department\n\n-   Likert scale ratings on a survey\n\n-   Employee job performance ratings\n:::\n:::\n\n## Proportional odds model {.midi}\n\nLet $Y$ be an ordinal response variable that takes levels $1, 2, \\ldots, J$ with associated probabilities $p_1, p_2, \\ldots, p_J$\n\n. . .\n\nThe **proportional odds model** can be written as the following:\n\n$$\\begin{aligned}&\\log\\Big(\\frac{P(Y \n\\leq 1)}{P(Y > 1)}\\Big) = \\beta_{01} - \\beta_1x_1 - \\dots -  \\beta_px_p \\\\\n& \\log\\Big(\\frac{P(Y\\leq 2)}{P(Y > 2)}\\Big) = \\beta_{02} -\\beta_1x_1 - \\dots -  \\beta_px_p \\\\\n& \\dots \\\\\n& \\log\\Big(\\frac{P(Y\\leq J-1)}{P(Y > J-1)}\\Big) = \\beta_{0{J-1}} - \\beta_1x_1 - \\dots - \\beta_px_p\\end{aligned}$$\n\n::: question\nWhat does $\\beta_{01}$ mean? What does $\\beta_1$ mean?\n:::\n\n## Proportional odds model {.midi}\n\nLet's consider one portion of the model:\n\n$$\n\\log\\Big(\\frac{P(Y\\leq k)}{P(Y > k)}\\Big) = \\beta_{0k} - \\beta_1x_1 - \\dots -  \\beta_px_p\n$$\n\n. . .\n\n::: incremental\n-   The response variable is $logit(Y\\leq k)$, the log-odds of observing an outcome less than or equal to category $k$.\n\n-   $\\beta_j > 0$ is associated with increased **log-odds** of being in a **higher** category of $Y$\n\n    -   $e^{\\beta_j}$ associated with an increased **odds** of being in a **higher** category of $Y$\n\n-   Effect of one unit increase in $x_j$ the same regardless of which category of $Y$\n:::\n\n## Effect of arrival mode on waiting time\n\n![Waiting time model output from @ataman2021predicting](images/09/oridinal-logistic-output.png){fig-align=\"center\"}\n\n::: question\nThe variable `arrival mode` has two possible values: ambulance and walk-in. Describe the effect of arrival mode on waiting time. Note: The baseline category is walk-in.\n:::\n\n## Effect of triage level\n\nConsider the full output with the ordinal logistic models for wait and treatment times.\n\n![Waiting and treatment time model output from @ataman2021predicting.](images/09/ordinal-model-full.png){fig-align=\"center\"}\n\n::: question\nUse the results from both models to describe the effect of triage level on waiting and treatment times. Note: The baseline category is green.\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_44c1cbcf\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;margin:1.25%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">02</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n## Fitting proportional odds models in R\n\nFit proportional odds models using the `polr` function in the **MASS** package:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nproportional_model <- polr(Y ~ x1 + x2 + x3, data = my_data)\n```\n:::\n\n\n<!--Do the soccer data example from the people analytics book -->\n\n<!--https://peopleanalytics-regression-book.org/ord-reg.html#ord-walkthrough-->\n\n## Multinomial logistic model {.midi}\n\nSuppose the outcome variable $Y$ is categorical and can take values $1, 2, \\ldots, K$ such that\n\n$$\nP(Y = 1) = p_1, \\ldots , P(Y = K) = p_K  \\hspace{5mm} \\text{ and } \\hspace{5mm}  \\sum_{k = 1}^{K} p_k = 1\n$$\n\n. . .\n\nChoose baseline category. Let's choose $Y = 1$ . Then\n\n. . .\n\n$$\\begin{aligned}&\\log\\Big(\\frac{P(Y = 2)}{P(Y = 1)}\\Big) = \\beta_{02} - \\beta_{12}x_1 - \\dots -  \\beta_{p2}x_p \\\\\n& \\log\\Big(\\frac{P(Y = 3)}{P(Y =1)}\\Big) = \\beta_{03} -\\beta_{13}x_1 - \\dots -  \\beta_{p3}x_p \\\\\n& \\dots \\\\\n& \\log\\Big(\\frac{P(Y = K)}{P(Y = 1)}\\Big) = \\beta_{0{K}} - \\beta_{1K}x_1 - \\dots - \\beta_{pK}x_{p}\\end{aligned}$$\n\n## Multinomial logistic vs. proportional odds\n\n::: question\nHow is the proportional odds model similar to the multinomial logistic model? How is it different? What is an advantage of each model? What is a disadvantage?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_e2b9fe75\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;margin:1.25%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Probit regression {.midi}\n\n## Impact of nature documentary on recycling\n\n@ibanez2022impact conducted an experiment to understand the impact of watching a nature documentary on pro-environmental behavior. The researchers randomly assigned the 113 participants to watch an video about architecture in NYC (control) or a video about Yellowstone National Park (treatment). As part of the experiment, participants were asked to dispose of their headphone coverings in a recycle bin available at the end of the experiment.\n\n::: aside\n[Click here](https://canvas.duke.edu/courses/25310/files/folder/journal-articles?preview=897959) to access the article on Canvas.\n:::\n\n## Impact of nature documentary on recycling\n\n**Response variable**: Recycle headphone coverings vs. not\n\n**Predictor variables:**\n\n-   Age\n-   Gender\n-   Student\n-   Made donation to environmental organization in previous part of experiment\n-   Environmental beliefs measured by the new ecological paradigm scale (NEP)\n\n## Probit regression\n\nLet $Y$ be a binary response variable that takes values 0 or 1, and let $p = P(Y = 1 | x_1, \\ldots, x_p)$\n\n$$\nprobit(p) = \\Phi^{-1}(p) = \\beta_0 + \\beta_1 x_1+ \\dots + \\beta_px_p\n$$\n\nwhere $\\Phi^{-1}$ is the inverse normal distribution function.\n\n<br>\n\n. . .\n\nThe outcome is the z-score at which the cumulative probability is equal to $p$\n\n-   e.g. $probit(0.975) = \\Phi^{-1}(0.975) = 1.96$\n\n## Interpretation\n\n-   $\\hat{\\beta}_j$ is the estimated change in z-score for each unit increase in $x_j$, holding all other factors constant.\n\n-   This is a fairly clunky interpretation, so the **(average) marginal effect** of $x_j$ is often interpreted instead\n\n-   The marginal effect of $x_j$ is essentially the change the probability from variable $x_j$\n\n## Impact of nature documentary\n\n::: columns\n::: {.column width=\"60%\"}\n![Recycling model from @ibanez2022impact](images/09/probit-regression-model.PNG){fig-align=\"center\" width=\"200%\"}\n:::\n\n::: {.column width=\"40%\"}\n::: question\nInterpret the effect of watching the nature documentary `Nature (T2)` on recycling. Assume NEP is low, `NEP-High` = 0.\n:::\n:::\n:::\n\n## Probit vs. logistic regression {.midi}\n\n**Pros of probit regression:**\n\n-   Some statisticians like assuming the normal distribution over the logistic distribution.\n\n-   Easier to work with in more advanced settings, such as multivariate and Bayesian modeling\n\n. . .\n\n**Cons of probit regression:**\n\n-   Z-scores are not as straightforward to interpret as the outcomes of a logistic model.\n\n-   We canâ€™t use odds ratios to describe findings.\n\n-   Itâ€™s more mathematically complicated than logistic regression.\n\n-   It does not work well for response variable with 3+ categories\n\n::: aside\nList adapted from [Categorical Regression](https://bookdown.org/sarahwerth2024/CategoricalBook/probit-regression-r.html).\n:::\n\n## Fitting probit regression models in R\n\nFit probit regression models using the `glm` function with `family = binomial(link = probit)`.\n\n<br>\n\nCalculate marginal effects using the `margins` function from the **margins** R package.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmargins(my_model, variables = \"my_variables\")\n```\n:::\n\n\n## Ideology vs. issue statements\n\nLet's look at the model using ideology and party ID to explain the number of issue statements by politicians. We will use probit regression for the \"hurdle\" part of the model - the likelihood a candidate comments on at least one issue (`has_issue_stmt`)\n\n. . .\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhurdle_probit <- glm(has_issue_stmt ~ ideology + democrat, \n             data = politics, \n             family = binomial(link = probit))\n```\n:::\n\n\n::: aside\nSee Section 4.11.2 of @roback2021beyond for more detail about the data.\n:::\n\n## Hurdle (using probit regression)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntidy(hurdle_probit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |    1.272|     0.117|    10.829|   0.000|\n|ideology    |    0.262|     0.089|     2.926|   0.003|\n|democrat1   |    0.149|     0.180|     0.827|   0.408|\n\n\n:::\n\n```{.r .cell-code}\nmargins(hurdle_probit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n ideology democrat1\n  0.04071   0.02333\n```\n\n\n:::\n:::\n\n\n::: question\nInterpret the effect of `democrat` on commenting on at least one issue.\n:::\n\n## Hurdle (using logistic regression)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhurdle_logistic <- glm(has_issue_stmt ~ ideology + democrat, \n             data = politics, \n             family = binomial)\n\ntidy(hurdle_logistic) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |    2.127|     0.225|     9.465|   0.000|\n|ideology    |    0.575|     0.167|     3.446|   0.001|\n|democrat1   |    0.428|     0.349|     1.225|   0.221|\n\n\n:::\n:::\n\n\n## Probit vs. logistic models\n\n::: columns\n::: {.column width=\"50%\"}\n**Probit model**\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate|\n|:-----------|--------:|\n|(Intercept) |    1.272|\n|ideology    |    0.262|\n|democrat1   |    0.149|\n\n\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n**Logistic model**\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|term        | estimate|\n|:-----------|--------:|\n|(Intercept) |    2.127|\n|ideology    |    0.575|\n|democrat1   |    0.428|\n\n\n:::\n:::\n\n:::\n:::\n\n<br>\n\n::: question\nSuppose there is democratic representative with ideology score -2.5. Based on the probit model, what is the probability they will comment on at least one issue? What is the probability based on the logistic model?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_c68500f9\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;margin:1.25%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Wrap up GLM for independent observations\n\n## Wrap up {.midi}\n\n-   Covered fitting, interpreting, and drawing conclusions from GLMs\n\n    -   Looked at Poisson, Negative Binomial, and Logistic, Proportional odds, and Probit models in detail\n\n-   Used Pearson and deviance residuals to assess model fit and determine if new variables should be added to the model\n\n-   Addressed issues of overdispersion and zero-inflation\n\n-   Used the properties of the one-parameter exponential family to identify the best link function for any GLM\n\n. . .\n\nEverything we've done thus far as been under the assumption that the observations are *independent*. Looking ahead we will consider models for data with **dependent (correlated) observations**.\n\n## References\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}