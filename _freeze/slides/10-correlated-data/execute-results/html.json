{
  "hash": "3093831fdd6b03863e02efcdf19ac2cb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Correlated data\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"February 19, 2024\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n## Announcements\n\n-   Quiz 02: Tue, Feb 20, 9am - Thu, Feb 22, 12pm (noon)\n\n    -   Covers readings & lectures: Jan 24 - Feb 12\n\n    -   Poisson regression, unifying framework for GLMs, logistic regression, proportional odds models, probit regression\n\n## Learning goals\n\n-   Recognize a potential for correlation in a data set\n-   Identify observational units at varying levels\n-   Understand issues correlated data may cause in modeling\n-   Understand how random effects models can be used to take correlation into account\n\n::: aside\nNotes based on Chapter 7 of @roback2021beyond unless noted otherwise.\n:::\n\n# Correlated observations\n\n## Examples of correlated data {.midi}\n\n::: incremental\n-   In an education study, test scores for students from a particular teacher are typically more similar than test scores of other students with a different teacher\n-   In a study measuring depression indices weekly over a month, the four measures for the same patient tend to be more similar than depression indices from other patients\n-   In political polling, opinions of members from the same household tend to be more similar than opinions of members from another household\n:::\n\n. . .\n\nCorrelation among outcomes within the same group (teacher, patient, household) is called **intraclass correlation**\n\n## Multilevel data {.midi}\n\n::: incremental\n-   We can think of correlated data as a multilevel structure\n\n    -   Population elements are aggregated into groups\n\n    -   There are observational units and measurements at each level\n\n-   For now we will focus on data with two levels:\n\n    -   **Level one**: Most basic level of observation\n    -   **Level two**: Groups formed from aggregated level-one observations\n:::\n\n## Multilevel data example \n\nExample: education study\n\n-   **Level one**\n\n    -   **Observational units**: students\n\n    -   **Level-one covariates**: test scores (response), year in school, demographics\n\n-   **Level two**\n\n    -   **Observational units**: teachers\n\n    -   **Level-two covariates**:years of experience\n\n## Two types of effects in model\n\n-   **Fixed effects**: Effects that are of interest in the study\n    -   Can think of these as effects whose interpretations would be included in a write up of the study\n\n. . .\n\n-   **Random effects**: Not interested in studying effects of specific values in the data but we want to understand the variability\n    -   Can think of these as effects whose interpretations would not necessarily be included in a write up of the study\n\n## Example\n\nResearchers are interested in understanding the effect social media has on opinions about a proposed economic plan. They randomly select 1000 households. They ask each adult in the household how many minutes they spend on social media daily and whether they support the proposed economic plan.\n\n. . .\n\n-   daily minutes on social media is the fixed effect\n-   household is the random effect\n\n## Practice {.midi}\n\nRadon is a carcinogen â€“ a naturally occurring radioactive gas whose decay products are also radioactive â€“ known to cause lung cancer in high concentrations. The EPA sampled more than 80,000 homes across the U.S. Each house came from a randomly selected county and measurements were made on each level of each home. Uranium measurements at the county level were included to improve the radon estimates.[^1]\n\n[^1]: From Ex. 1 in Section 7.10.1 of BMLR\n\n. . .\n\n::: question\n1.  What are the level one and level two observational units?\n\n2.   What is the response variable and what is its type (normal, Poisson, etc.)?\n\n3.  Describe the within-group correlation.\n\n4.  What are the fixed effects? What are the random effects?\n:::\n\n# Teratogen and rat pups\n\n## Data: Teratogen and rat pups {.midi}\n\nToday's data are simulated results of an experiment with 24 dams (mother rats) randomly divided into four groups that received different doses of teratogen, a substance that could potentially cause harm to developing fetuses. The four groups are\n\n-   High dose (3 mg)\n-   Medium dose (2 mg)\n-   Low dose (1 mg)\n-   No dose (Control)\n\nEach dam produced 10 rat pups and the presence of a deformity was noted for each pup.\n\n. . .\n\n**Goal**: Understand the association between teratogen exposure and the probability a pup is born with a deformity.\n\n## Sources of variation  {.midi}\n\n::: incremental\n-   **Dose effect:** Studying whether different dose levels are associated with different probabilities of birth defects in the pups.\n\n    -   Dose is a **fixed effect**. Study is interested in defect rate at specific dose levels.\n\n-   **Dam (litter) effect:** Different dams may have different propensity to produce pups with defects, i.e. pups from same litter are more likely to be similar than pups from different litters.\n\n    -   Dam is a **random effect.** Study is not interested in defect rate for each specific dam in the study but is interested in variability between litters.\n\n-   **Pup-to-pup variability**: Within litter pup differences. This is the unexplained variability.\n:::\n\n## Scenario 1: No dose effect {.midi}\n\nAssume dose has <u>no</u> effect on, $p$, the probability of a pup born with a deformity.\n\n-   **Scenario 1a.**: $p = 0.5$ for each dam\n\n-   **Scenario 1b.**: $p \\sim Beta(0.5, 0.5)$ (expected value = 0.5)\n\n. . .\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\" fig-caption='From Figure 7.1 in BMLR'}\n::: {.cell-output-display}\n![](10-correlated-data_files/figure-revealjs/scenario1ProbabilityPlot-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n---\n\n::: question\n1.  Would you expect the number of pups with a deformity for dams in Scenario 1a to follow a distribution similar to the binomial distribution with $n=10$ and $p=0.5$? Why or why not?\n\n2.  Would you expect the number of pups with a deformity for dams in Scenario 1b to follow a distribution similar to the binomial distribution with $n=10$ and $p=0.5$? Why or why not?\n\n3.  Which scenario do you think is more realistic - Scenario 1a or 1b?\n:::\n\n---\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](10-correlated-data_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=65%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> mean_1a </th>\n   <th style=\"text-align:right;\"> sd_1a </th>\n   <th style=\"text-align:right;\"> mean_1b </th>\n   <th style=\"text-align:right;\"> sd_1b </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 5.166667 </td>\n   <td style=\"text-align:right;\"> 1.493949 </td>\n   <td style=\"text-align:right;\"> 5.666667 </td>\n   <td style=\"text-align:right;\"> 4.103727 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n# Application exercise\n\nLet's take a look at a binomial and quasibinomial model for Scenarios 1a and 1b.\n\n::: appex\nðŸ“‹ [sta310-sp24.netlify.app/ae/lec-10-correlated](https://sta310-sp24.netlify.app/ae/lec-10-correlated.html)\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_b28b3dcf\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">08</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Scenario 2: Dose effect\n\n## Scenario 2: Dose effect {.midi}\n\nNow we will consider the effect of the dose of teratogen on the probability of a pup born with a deformity. The 24 pups have been randomly divided into four groups:\n\n-   High dose (`dose = 3`)\n-   Medium dose (`dose = 2`)\n-   Low dose (`dose = 1`)\n-   No dose (`dose = 0`)\n\n. . .\n\nWe will assume the true relationship between $p$ and dose is the following:\n\n$$\\log\\Big(\\frac{p}{1-p}\\Big) = -2 + 1.33 ~ dose$$\n\n## Scenario 2 {.midi}\n\n**Scenario 2a.**\n\n$$p = \\frac{e^{-2 + 1.33 ~ dose}}{1 + e^{-2 + 1.33 ~ dose}}$$\n\n. . .\n\n**Scenario 2b.**\n\n$$p \\sim Beta\\Big(\\frac{2p}{(1-p)}, 2\\Big)$$\n\n. . .\n\nOn average, dams who receive dose $x$ have the same probability of pup born with deformity as dams with dose $x$ under Scenario 2a.\n\n-   e.g., If `dose = 1`, the probability of a pup born with deformity is 0.338 in Scenario 2a and the mean is 0.338 in Scenario 2b.\n\n## Distributions under Scenario 2\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](10-correlated-data_files/figure-revealjs/scenario2bPlot-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## Scenario 2 summary statistics {.midi}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Summary statistics of Scenario 2 by dose.</caption>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"4\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Scenario 2a</div></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"4\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Scenario 2b</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:right;\"> Dosage </th>\n   <th style=\"text-align:right;\"> Mean p </th>\n   <th style=\"text-align:right;\"> SD p </th>\n   <th style=\"text-align:right;\"> Mean Count </th>\n   <th style=\"text-align:right;\"> SD Count </th>\n   <th style=\"text-align:right;\"> Mean p </th>\n   <th style=\"text-align:right;\"> SD p </th>\n   <th style=\"text-align:right;\"> Mean Count </th>\n   <th style=\"text-align:right;\"> SD Count </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.333 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.366 </td>\n   <td style=\"text-align:right;\"> 0.061 </td>\n   <td style=\"text-align:right;\"> 0.069 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 0.500 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 0.837 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.339 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 3.167 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.835 </td>\n   <td style=\"text-align:right;\"> 0.239 </td>\n   <td style=\"text-align:right;\"> 0.208 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 3.500 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 2.881 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.661 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 5.833 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.472 </td>\n   <td style=\"text-align:right;\"> 0.615 </td>\n   <td style=\"text-align:right;\"> 0.195 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 5.833 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.941 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0.881 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 8.833 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.169 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> 0.079 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 8.833 </td>\n   <td style=\"text-align:right;width: 1cm; \"> 1.169 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n::: aside\nFrom Table 7.2 in BMLR\n:::\n\n---\n\n::: question\n1.  In Scenario 2a, dams produced 4.79 deformed pups on average, with standard deviation 3.20. Scenario 2b saw an average of 4.67 with standard deviation 3.58. Why are comparisons by dose more meaningful than these overall comparisons?\n2.  We will use binomial and quasibinomial regression to model the relationship between dose and probability of pup born with a deformity. What can you say about the center and the width of the confidence intervals under Scenarios 2a and 2b?\n    1.  Which will be similar and why?\n    2.  Which will be different and how?\n:::\n\n## Scenario 2: Estimated odds ratio {.midi}\n\nThe estimated effect of dose and the 95% CI from the binomial and quasibinomial models are below:\n\n**Scenario 2a**\n\n|               | Odds Ratio | 95% CI         |\n|---------------|------------|----------------|\n| Binomial      | 3.536      | (2.604, 4.958) |\n| Quasibinomial | 3.536      | (2.512, 5.186) |\n\n**Scenario 2b**\n\n|               | Odds Ratio | 95% CI         |\n|---------------|------------|----------------|\n| Binomial      | 4.311      | (3.086, 6.271) |\n| Quasibinomial | 4.311      | (2.735, 7.352) |\n\n---\n\n::: question\n1.  Describe how the quasibinomial analysis of Scenario 2b differs from the binomial analysis of the same simulated data. Do confidence intervals contain the true model parameters? Is this what you expected? Why?\n\n\n```{=html}\n<!-- -->\n```\n\n2.  Why does Scenario 2b contain correlated data that we must account for, while Scenario 2a does not?\n:::\n\n## Data structure\n\n![From Figure 7.4 in BMLR](images/10/pups-data-structure.png){fig-align=\"center\"}\n\n##  Preview: Fit model with random effect\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lme4)\nlibrary(broom.mixed)\nrandom_effect_model <- glmer(deformity ~ dose + (1|dam), \n                          family = binomial, data = scenario2_raw)\ntidy(random_effect_model, conf.int = TRUE) |> \n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> effect </th>\n   <th style=\"text-align:left;\"> group </th>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -2.819 </td>\n   <td style=\"text-align:right;\"> 0.528 </td>\n   <td style=\"text-align:right;\"> -5.343 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> -3.853 </td>\n   <td style=\"text-align:right;\"> -1.785 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> dose </td>\n   <td style=\"text-align:right;\"> 1.691 </td>\n   <td style=\"text-align:right;\"> 0.282 </td>\n   <td style=\"text-align:right;\"> 5.992 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1.138 </td>\n   <td style=\"text-align:right;\"> 2.244 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> dam </td>\n   <td style=\"text-align:left;\"> sd__(Intercept) </td>\n   <td style=\"text-align:right;\"> 0.834 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Summary\n\n-   The structure of the data set may imply correlation between observations.\n\n-   Correlated observations provide less information than independent observations; we need to account for this reduction in information.\n\n-   Failing to account for this reduction could result in underestimating standard error, thus resulting in overstating significance and the precision of the estimates.\n\n-   We showed how we can account for this by incorporating the dispersion parameter or a random effect.\n\n## References\n",
    "supporting": [
      "10-correlated-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}