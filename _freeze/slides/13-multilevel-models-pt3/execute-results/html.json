{
  "hash": "dab42a06a629904738e0162796c9bf3d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Multilevel models\"\nsubtitle: \"Interpretation + Estimation\"\ndate: \"February 28, 2024\"\ndate-format: \"MMM DD, YYYY\"\nauthor: \"Prof. Maria Tackett\"\nfooter: \"[ðŸ”— STA 310 - Spring 2024](https://sta310-sp24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    slide-number: true\n    multiplex: false\n    transition: fade\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n## Announcements\n\n-   HW 03 due TODAY at 11:59pm\n-   DataFest: March 1 - 3 in Penn Pavilion\n    -   See Slack for more information\n-   Please fill out Campus Culture Survey by March 1\n    -   You should have received an email with a personalized link\n\n## Topics\n\n-   Interpret and inference for multilevel model coefficients\n\n-   Calculate and interpret intraclass correlation coefficient\n\n-   Maximum likelihood (ML) and restricted maximum likelihood (REML) estimation approaches\n\n-   General process for fitting and comparing multilevel models\n\n::: aside\nNotes based on Chapter 8 of @roback2021beyond unless noted otherwise.\n:::\n\n## Data: Music performance anxiety {.midi}\n\nToday's data come from the study by @sadler2010performance of the emotional state of musicians before performances. The data set contains information collected from 37 undergraduate music majors who completed the Positive Affect Negative Affect Schedule (PANAS), an instrument produces a measure of anxiety (negative affect) and a measure of happiness (positive affect). This analysis will focus on negative affect as a measure of performance anxiety.\n\nThe primary variables we'll use are\n\n-   **`id`**: unique musician identification number\n-   **`na`**: negative affect score on PANAS (the response variable)\n-   **`perform_type`**: type of performance (Solo, Large Ensemble, Small Ensemble)\n-   **`instrument`**: type of instrument (Voice, Orchestral, Piano)\n\n## Fit model in R\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lme4)\nmusic_model <- lmer(na ~ orchestra + large_ensemble +\n       orchestra:large_ensemble + (large_ensemble|id),\n       REML = TRUE, data = music)\n```\n:::\n\n\n-   `na ~ orchestra + large_ensemble + orchestra:large_ensemble`: Represents the fixed effects\n\n-   `(large_ensemble|id)`: Represents the error terms and associated variance components\n\n    -   Specifies two error terms: $u_i$ corresponding to the intercepts, $v_i$ corresponding to effect of large ensemble\n    -   Use `(1|id)` for models with random intercepts and all other effects fixed.\n\n## Model results {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> effect </th>\n   <th style=\"text-align:left;\"> group </th>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 15.930 </td>\n   <td style=\"text-align:right;\"> 0.641 </td>\n   <td style=\"text-align:right;\"> 24.833 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> orchestra1 </td>\n   <td style=\"text-align:right;\"> 1.693 </td>\n   <td style=\"text-align:right;\"> 0.945 </td>\n   <td style=\"text-align:right;\"> 1.791 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -0.911 </td>\n   <td style=\"text-align:right;\"> 0.845 </td>\n   <td style=\"text-align:right;\"> -1.077 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> orchestra1:large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -1.424 </td>\n   <td style=\"text-align:right;\"> 1.099 </td>\n   <td style=\"text-align:right;\"> -1.295 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> id </td>\n   <td style=\"text-align:left;\"> sd__(Intercept) </td>\n   <td style=\"text-align:right;\"> 2.378 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> id </td>\n   <td style=\"text-align:left;\"> cor__(Intercept).large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -0.635 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> id </td>\n   <td style=\"text-align:left;\"> sd__large_ensemble1 </td>\n   <td style=\"text-align:right;\"> 0.672 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> Residual </td>\n   <td style=\"text-align:left;\"> sd__Observation </td>\n   <td style=\"text-align:right;\"> 4.670 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Interpretation {.midi}\n\n::: question\nSelect the best interpretation for `orchestra1:large_ensemble1`.\n\na.  For students who play an orchestral instrument, the mean performance anxiety is expected to be 1.424 points lower for large ensemble performances compared to solo and small ensembles.\n\nb.  The mean decrease in performance anxiety from large ensemble performances versus solos or small ensembles is expected to be 1.424 points greater for students who play orchestral instruments than the expected decrease for soloists and pianists.\n\nc.  The mean performance anxiety for students who play orchestral instruments in large ensembles is expected to be -1.424 points.\n:::\n\n## Interpretation \n\n::: question\nSelect the best interpretation for `sd__(Intercept)`.\n\na.  The estimated standard deviation of performance anxiety score for students playing in solos and small ensembles is 2.378 points.\n\nb.  The estimated standard deviation of performance anxiety score for vocalists and pianists is 2.378 points.\n\nc.  The estimated standard deviation of performance anxiety score for students playing in solos and small ensemble is 2.378, after adjusting for instrument.\n:::\n\n## Inference for fixed effects\n\n-   Notice the R model output has test statistic but no p-values for each coefficient\n\n    -   Exact $t$ distribution under the null hypothesis (no fixed effects) and the associated degrees of freedom are not known\n\n-   We can generally conclude coefficients with test statistic with absolute value greater than 2 are statistically significant\n\n-   Some software will produce p-values by making several assumptions, large sample results , or approximate p-values\n\n-   We will introduce a parametric bootstrap approach in the next chapter.\n\n## Unconditional means model\n\nThe **unconditional means model** (also known as random intercepts model) is the multilevel model with no predictors at either level\n\nThese models are used to estimate between and within group variability\n\n. . .\n\nLevel One:\n\n$$Y_{ij} = a_i + \\epsilon_{ij} \\hspace{10mm} \\epsilon_{ij} \\sim N(0, \\sigma^2)$$\n\nLevel Two:\n\n$$\na_i = \\alpha_0 + u_i \\hspace{10mm} u_i \\sim(N, \\sigma_u^2)\n$$\n\n## Fitting the unconditional means model\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nuncond_means_model <- lmer(na ~ 1 + (1 | id), \n                           REML = TRUE, data = music)\n\ntidy(uncond_means_model) |> kable(digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> effect </th>\n   <th style=\"text-align:left;\"> group </th>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> fixed </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 16.237 </td>\n   <td style=\"text-align:right;\"> 0.428 </td>\n   <td style=\"text-align:right;\"> 37.943 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> id </td>\n   <td style=\"text-align:left;\"> sd__(Intercept) </td>\n   <td style=\"text-align:right;\"> 2.225 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ran_pars </td>\n   <td style=\"text-align:left;\"> Residual </td>\n   <td style=\"text-align:left;\"> sd__Observation </td>\n   <td style=\"text-align:right;\"> 4.739 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Intraclass correlation coefficient {.midi}\n\nThe **intraclass correlation coefficient** $\\rho$ is\n\n$$\n\\rho = \\frac{\\text{Between group variability}}{\\text{Total variability}} = \\frac{\\sigma^2_u}{\\sigma^2_u + \\sigma^2}\n$$\n\n. . .\n\nIn this analysis, $\\hat{\\rho} = 0.182$ . This value means...\n\n. . .\n\n-   About 18.2% of the variability in performance anxiety can be explained by musician to musician differences\n\n-   The correlation of performance anxiety scores within a musician is 0.182\n\n. . .\n\n::: callout-note\n$\\hat{\\rho}$ is calculated based on the variance components from the unconditional means model.\n:::\n\n## Interpreting $\\rho$ {.midi}\n\n::: question\nWhich of the following values indicates the individual observations are essentially independent?\n\n1.  $\\rho \\approx 1$\n2.  $\\rho \\approx 0$\n:::\n\n. . .\n\n::: incremental\n-   When $\\rho \\approx 0$ , the **effective sample size** (how many pieces of independent information we have) approaches $n$, the sample size of the data\n\n    -   Accounting for multilevel structure of the data is less important when modeling\n\n-   When $\\rho \\approx 1$, the effective sample size is close to the number of groups\n\n    -   Accounting for multilevel structure of the data is very important when modeling\n:::\n\n# Estimation\n\n## ML and REML {.midi}\n\nMaximum Likelihood (ML) and Restricted (Residual) Maximum Likelihood (REML) are the two most common methods for estimating the fixed effects and variance components\n\n. . .\n\n**Maximum Likelihood (ML)**\n\n-   Jointly estimate the fixed effects and variance components using all the <u></u>sample data</u>\n-   Can be used to draw conclusions about fixed and random effects\n\n::: callout-caution\n*Issue*: Fixed effects are treated as known values when estimating variance components\n\n-   Tends to underestimate variance components (biased estimate), particularly when the sample size is small.\n:::\n\n## ML and REML\n\n**Restricted Maximum Likelihood (REML)**\n\n-   Estimate the variance components using the <u>sample residuals</u> not the sample data\n-   It is conditional on the fixed effects, so it accounts for uncertainty in fixed effects estimates.\n    -   This results in unbiased estimates of variance components.\n\n## Illustration of ML vs. REML\n\n::: columns\n::: {.column width=\"50%\"}\n**ML**\n\n$$\ns^2 = \\frac{\\sum_{i=1}^n(x_i - \\bar{x})^2}{n}\n$$\n\nTreats $\\bar{x}$ as known value (no loss in degrees of freedom)\n:::\n\n::: {.column width=\"50%\"}\n**REML**\n\n$$\ns^2 = \\frac{\\sum_{i=1}^n(x_i - \\bar{x})^2}{n-1}\n$$\\\nTreats $\\bar{x}$ as estimated value (accounts for loss of degree of freedom)\n:::\n:::\n\n<br>\n\n*Note: These differences are small when* $n$ *is large.*\n\n## ML or REML? {.midi}\n\n-   Research has not determined one method absolutely superior to the other\n\n-   **REML** (`REML = TRUE`; default in `lmer`) is preferable when\n\n    -   the number of parameters is large, or\n    -   primary objective is to obtain estimates of the model parameters\n\n-   **ML** (`REML = FALSE`) <u>must</u> be used if you want to compare nested fixed effects models using a likelihood ratio test (e.g., a drop-in-deviance test).\n\n    -   For REML, the goodness-of-fit and likelihood ratio tests can only be used to draw conclusions about variance components\n\n-   In most cases, there is little difference between the results from ML and REML\n\n<br>\n\n::: aside\nSee @singer2003applied for additional detail.\n:::\n\n## Comparing ML and REML results {.small}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">ML</div></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">REML</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> SE </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> SE </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 15.924 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> 0.623 </td>\n   <td style=\"text-align:right;\"> 15.930 </td>\n   <td style=\"text-align:right;\"> 0.641 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> orchestra1 </td>\n   <td style=\"text-align:right;\"> 1.696 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> 0.919 </td>\n   <td style=\"text-align:right;\"> 1.693 </td>\n   <td style=\"text-align:right;\"> 0.945 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -0.895 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> 0.827 </td>\n   <td style=\"text-align:right;\"> -0.911 </td>\n   <td style=\"text-align:right;\"> 0.845 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> orchestra1:large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -1.438 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> 1.074 </td>\n   <td style=\"text-align:right;\"> -1.424 </td>\n   <td style=\"text-align:right;\"> 1.099 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sd__(Intercept) </td>\n   <td style=\"text-align:right;\"> 2.286 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> NA </td>\n   <td style=\"text-align:right;\"> 2.378 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cor__(Intercept).large_ensemble1 </td>\n   <td style=\"text-align:right;\"> -1.000 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> NA </td>\n   <td style=\"text-align:right;\"> -0.635 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sd__large_ensemble1 </td>\n   <td style=\"text-align:right;\"> 0.385 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> NA </td>\n   <td style=\"text-align:right;\"> 0.672 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> sd__Observation </td>\n   <td style=\"text-align:right;\"> 4.665 </td>\n   <td style=\"text-align:right;border-right:1px solid;\"> NA </td>\n   <td style=\"text-align:right;\"> 4.670 </td>\n   <td style=\"text-align:right;\"> NA </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Strategy for building multilevel models {.midi}\n\n-   Conduct exploratory data analysis for Level One and Level Two variables\n\n-   Fit model with no covariates to assess variability at each level\n\n-   Create Level One models. Start with a single term, then add terms as needed.\n\n-   Create Level Two models. Start with a single term, then add terms as needed. Start with equation for intercept term.\n\n-   Begin with the full set of variance components, then remove covariance and variance terms as needed.\n\n<br>\n\n::: callout-note\n*Alternate model building strategies in [BMLR Section 8.6](https://bookdown.org/roback/bookdown-BeyondMLR/ch-multilevelintro.html#sec:buildmodel)*\n:::\n\n## References\n",
    "supporting": [
      "13-multilevel-models-pt3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}