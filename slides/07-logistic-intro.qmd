---
title: "Logistic regression"
author: "Prof. Maria Tackett"
date: "February 5, 2024"
date-format: "MMM DD, YYYY"
footer: "[ðŸ”— STA 310 - Spring 2024](https://sta310-sp24.netlify.app)"
logo: "../images/logo.png"
format: 
  revealjs:
    theme: slides.scss
    slide-number: true
    multiplex: false
    transition: fade
    incremental: false 
    chalkboard: true
html-math-method:
  method: mathjax
  url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
execute:
  freeze: auto
  echo: true
  warning: false
  message: false
knitr:
  opts_chunk: 
    R.options:      
    width: 200
bibliography: references.bib
---

```{r setup, include = F}
knitr::opts_chunk$set( fig.width = 8,
                      fig.asp = 0.618, 
                      fig.retina = 3, 
                      dpt = 300, 
                      out.width = "70%",
                      fig.align = "center")

ggplot2::theme_set(ggplot2::theme_bw(base_size = 16))

colors <- tibble::tibble(green = "#B5BA72")
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(knitr)
library(patchwork)
library(viridis)
```

## Topics

-   Identify Bernoulli and binomial random variables

-   Write GLM for binomial response variable

-   Interpret the coefficients for a logistic regression model

::: aside
Notes based on Chapter 6 @roback2021beyond unless noted otherwise.
:::

# Basics of logistic regression

## Bernoulli + Binomial random variables {.small}

Logistic regression is used to analyze data with two types of responses:

-   **Binary**: These responses take on two values success $(Y = 1)$ or failure $(Y = 0)$, yes $(Y = 1)$ or no $(Y = 0)$, etc.

$$P(Y = y) = p^y(1-p)^{1-y} \hspace{10mm} y = 0, 1$$

-   **Binomial**: Number of successes in a Bernoulli process, $n$ independent trials with a constant probability of success $p$.

$$P(Y = y) = {n \choose y}p^{y}(1-p)^{n - y} \hspace{10mm} y = 0, 1, \ldots, n$$

. . .

In both instances, the goal is to model $p$ the probability of success.

## Binary vs. Binomial data {.midi}

::: question
For each example, identify if the response is a Bernoulli or Binomial response:

1.  Use median age and unemployment rate in a county to predict the percent of Obama votes in the county in the 2008 presidential election.
2.  Use GPA and MCAT scores to estimate the probability a student is accepted into medical school.
3.  Use sex, age, and smoking history to estimate the probability an individual has lung cancer.
4.  Use offensive and defensive statistics from the 2017-2018 NBA season to predict a team's winning percentage.
:::

```{r echo = F}
library(countdown)
countdown(minutes = 3, seconds = 0,
          margin = "1.25%")
```

## Logistic regression model  {.midi}

$$
\log\Big(\frac{p}{1-p}\Big) = \beta_0 + \beta_1x_1 + \beta_2x_2 + \dots + \beta_px_p
$$

. . .

-   The response variable, $\log\Big(\frac{p}{1-p}\Big)$, is the log(odds) of success, i.e. the logit

. . .

-   Use the model to calculate the probability of success $$\hat{p} = \frac{e^{\beta_0 + \beta_1x_1 + \beta_2x_2 + \dots + \beta_px_p}}{1 + e^{\beta_0 + \beta_1x_1 + \beta_2x_2 + \dots + \beta_px_p}}$$

. . .

-   When the response is a Bernoulli random variable, the probabilities can be used to classify each observation as a success or failure

## Logistic vs linear regression model

```{r, OLSlogistic, fig.align="center", out.width="60%", fig.cap='Graph from BMLR Chapter 6', echo=FALSE, warning=FALSE, message=FALSE}

set.seed(0)
dat <- tibble(x=runif(200, -5, 10),
                  p=exp(-2+1*x)/(1+exp(-2+1*x)),
                  y=rbinom(200, 1, p),
                  y2=.3408+.0901*x,
                  logit=log(p/(1-p)))
dat2 <- tibble(x = c(dat$x, dat$x),
               y = c(dat$y2, dat$p),
               `Regression model` = c(rep("linear", 200),
                                      rep("logistic", 200)))

ggplot() + 
  geom_point(data = dat, aes(x, y)) +
  geom_line(data = dat2, aes(x, y, linetype = `Regression model`, 
                             color = `Regression model`)) + 
  labs(title = "Linear vs. logistic regression models",
  subtitle = "for binary response data") + 
  scale_colour_manual(name = 'Regression model',
                      values = c('blue', 'red'), 
                      labels = c('linear', 'logistic'), guide ='legend')

#ggplot(dat, aes(x = x)) +
#  geom_point(aes(y = y)) +
#  geom_smooth(aes(y = y, color = "blue"), method = "lm", 
#              linetype = 1, se=FALSE) +
#  geom_line(aes(y = p, color = "red"), linetype = 2) +
#  scale_colour_manual(name = 'Regression model', 
#         values = c('blue', 'red'), 
#         labels = c('linear', 'logistic'), guide = 'legend')
```

## Logit link

Bernoulli and Binomial random variables can be written in one-parameter exponential family form, $f(y;\theta) = e^{[a(y)b(\theta) + c(\theta) + d(y)]}$

**Bernoulli**

$$f(y;p) = e^{y\log(\frac{p}{1-p}) + \log(1-p)}$$

**Binomial**

$$f(y;n,p) = e^{y\log(\frac{p}{1-p}) + n\log(1-p) + \log{n \choose y}}$$

. . .

They have the same canonical link $b(p) = \log\big(\frac{p}{1-p}\big)$

## Assumptions for logistic regression {.midi}

The following assumptions need to be satisfied to use logistic regression to make inferences

`r emo::ji("one")` $\hspace{0.5mm}$ **Binary response**: The response is dichotomous (has two possible outcomes) or is the sum of dichotomous responses

. . .

`r emo::ji("two")` $\hspace{0.5mm}$ **Independence**: The observations must be independent of one another

. . .

`r emo::ji("three")` $\hspace{0.5mm}$ **Variance structure**: Variance of a binomial random variable is $np(1-p)$ $(n = 1 \text{ for Bernoulli})$ , so the variability is highest when $p = 0.5$

. . .

`r emo::ji("four")` $\hspace{0.5mm}$ **Linearity**: The log of the odds ratio, $\log\big(\frac{p}{1-p}\big)$, must be a linear function of the predictors $x_1, \ldots, x_p$

## COVID-19 infection prevention practices at food establishments

Researchers at Wollo Univeristy in Ethiopia conducted a study in July and August 2020 to understand factors associated with good COVID-19 infection prevention practices at food establishments. Their study is published in @andualem2022covid .

<br>

They were particularly interested in the understanding implementation of prevention practices at food establishments, given the workers' increased risk due to daily contact with customers.

## The data {.midi}

*"An institution-based cross-sectional study was conducted among* <b>*422 food handlers in Dessie City and Kombolcha Town food and drink establishments in July and August 2020.*</b> *The study participants were selected using a* <b>*simple random sampling*</b> *technique. Data were collected by trained data collectors using a pretested structured questionnaire and an on-the-spot observational checklist."*

## Response variable

*"The outcome variable of this study was the* <b>*good or poor practices of COVID-19 infection prevention among food handlers*</b>*. Nine yes/no questions, one observational checklist and five multiple choice infection prevention practices questions were asked with a minimum score of 1 and maximum score of 25. Good infection prevention practice (the variable of interest) was determined for food handlers who scored 75% or above, whereas poor infection prevention practices refers to those food handlers who scored below 75% on the practice questions."*

## Results

![](images/07/logistic-output.PNG){fig-align="center"}

## Interpreting the results {.midi}

::: question
-   Is the response a Bernoulli or Binomial?

-   What is the strongest predictor of having good COVID-19 infection prevention practices?

    -   It's often unreliable to look answer this question just based on the model output. Why are we able to answer this question based on the model output in this case?

-   Describe the effect (coefficient interpretation and inference) of having COVID-19 infection prevention policies available at the food establishment.

-   The intercept describes what group of food handlers?
:::

```{r echo = F}
library(countdown)
countdown(minutes = 4, seconds = 30,
          margin = "1.25%")
```

## References
